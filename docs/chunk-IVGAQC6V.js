import{a as le}from"./chunk-6ZEMUI4Q.js";import{a as Ke}from"./chunk-L7IEYTCS.js";import{a as Ct}from"./chunk-CHZWZK5J.js";import{a as j,b as me}from"./chunk-CK25IJLO.js";import{a as N,b as Ut,c as A,d as _t}from"./chunk-A7RA4PBA.js";import{a as be,d as f,e as ye,f as Me,o as Q,p as se,q as Fe,r as Ne,u as Ae,v as U,w as Te}from"./chunk-HNE7D7Y7.js";import{A as pt,B as dt,C as ct,D as ut,I as ft,a as He,b as Ge,e as qe,f as ze,g as Je,l as Qe,m as We,n as Xe,o as Ye,p as Ze,q as et,r as tt,s as rt,t as it,u as ot,v as nt,w as at,x as st,y as lt,z as mt}from"./chunk-IIQQG7MX.js";import{Ba as Re,Da as F,Fa as $e,Ga as Oe,Ia as je,Ja as Le,Ka as ke,La as Pe,Na as Ve,_ as De,b as Ee,ca as Ie,i as J,k as Se,m as ae,ta as W,ua as we,wa as X,ya as Be}from"./chunk-4SWAUFVP.js";import{Db as p,Ga as G,Ha as q,Ib as u,J as B,K as $,Nb as S,R as ce,Rb as o,Sb as i,Tb as c,Ub as D,Vb as I,Xb as fe,_b as b,a as d,ac as g,b as C,da as ue,dc as Ce,e as ne,gd as z,id as ve,jd as K,kb as m,kc as Ue,la as P,lb as _,lc as n,ld as he,ma as V,mc as h,md as xe,nc as R,oc as _e,qa as O,s as w,wa as x,wc as y,x as E,xa as H,xc as M,yc as ge,z as k}from"./chunk-PWY5XFB5.js";var vt=ne(me());function Mt(e,r){e&1&&(o(0,"mat-error",0),n(1,"Este campo es requerido"),i())}function Ft(e,r){if(e&1&&(o(0,"mat-error",0),n(1),i()),e&2){let t=g();m(),R(" Este campo requiere m\xEDnimo ",t.validationErrors==null||t.validationErrors.minlength==null?null:t.validationErrors.minlength.requiredLength,` caracteres
`)}}function Nt(e,r){e&1&&(o(0,"mat-error",0),n(1,"Este campo solo admite letras"),i())}function At(e,r){e&1&&(o(0,"mat-error",0),n(1,"El formato es incorrecto"),i())}var Y=class e{validationErrors=null;static \u0275fac=function(t){return new(t||e)};static \u0275cmp=x({type:e,selectors:[["app-control-errors"]],inputs:{validationErrors:"validationErrors"},decls:4,vars:4,consts:[["appFontSize","","fontSize","10px"]],template:function(t,a){t&1&&p(0,Mt,2,0,"mat-error",0)(1,Ft,2,1,"mat-error",0)(2,Nt,2,0,"mat-error",0)(3,At,2,0,"mat-error",0),t&2&&(S(a.validationErrors!=null&&a.validationErrors.required?0:-1),m(),S(a.validationErrors!=null&&a.validationErrors.minlength?1:-1),m(),S(a.validationErrors!=null&&a.validationErrors.pattern?2:-1),m(),S(a.validationErrors!=null&&a.validationErrors.email?3:-1))},dependencies:[Ge,Ke]})};function Rt(e,r){if(e&1&&c(0,"app-control-errors",17),e&2){let t=g();u("validationErrors",t.firstNameControl==null?null:t.firstNameControl.errors)}}function $t(e,r){if(e&1&&c(0,"app-control-errors",17),e&2){let t=g();u("validationErrors",t.lastNameControl==null?null:t.lastNameControl.errors)}}function Ot(e,r){if(e&1&&c(0,"app-control-errors",17),e&2){let t=g();u("validationErrors",t.emailControl==null?null:t.emailControl.errors)}}function jt(e,r){if(e&1&&c(0,"app-control-errors",17),e&2){let t=g();u("validationErrors",t.passwordControl==null?null:t.passwordControl.errors)}}var Z=class e{constructor(r,t,a){this.matDialogRef=r;this.formBuilder=t;this.data=a;this.userForm=this.formBuilder.group({firstName:[null,[F.required,le]],lastName:[null,[le]],email:[null,[F.required,F.email]],password:[null,[F.required,F.minLength(8)]],role:[null,[F.required]]}),this.patchForm()}userForm;get firstNameControl(){return this.userForm.get("firstName")}get lastNameControl(){return this.userForm.get("lastName")}get emailControl(){return this.userForm.get("email")}get passwordControl(){return this.userForm.get("password")}get roleControl(){return this.userForm.get("role")}get isEditing(){return!!this.data?.editUser}patchForm(){this.data?.editUser&&this.userForm.patchValue(this.data.editUser)}onSave(){this.userForm.invalid?this.userForm.markAllAsTouched():(this.matDialogRef.close(C(d({},this.userForm.value),{id:this.isEditing?this.data.editUser.id:j(25),createdAt:this.isEditing?this.data.editUser.createdAt:new Date,token:this.isEditing?this.data.editUser.token:j(16)})),vt.default.fire("Buen trabajo!",`El usuario ha sido ${this.isEditing?"editado":"creado"} exitosamente.`,"success"))}static \u0275fac=function(t){return new(t||e)(_(Qe),_(Pe),_(We))};static \u0275cmp=x({type:e,selectors:[["app-user-dialog"]],decls:38,vars:6,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[1,"row"],[1,"col-6"],["matInput","","formControlName","firstName","type","text"],[3,"validationErrors",4,"ngIf"],["matInput","","formControlName","lastName","type","text"],[1,"col-12"],["matInput","","type","email","formControlName","email"],["matInput","","type","text","formControlName","password"],["formControlName","role"],["value","admin"],["value","user"],["mat-dialog-actions",""],["mat-button","","mat-dialog-close",""],["mat-button","",3,"click"],[3,"validationErrors"]],template:function(t,a){t&1&&(o(0,"h1",0),n(1),i(),o(2,"div",1)(3,"form",2)(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),n(7,"Nombre"),i(),c(8,"input",5),p(9,Rt,1,1,"app-control-errors",6),i(),o(10,"mat-form-field",4)(11,"mat-label"),n(12,"Apellido"),i(),c(13,"input",7),p(14,$t,1,1,"app-control-errors",6),i()(),o(15,"mat-form-field",8)(16,"mat-label"),n(17,"Email"),i(),c(18,"input",9),p(19,Ot,1,1,"app-control-errors",6),i(),o(20,"mat-form-field",8)(21,"mat-label"),n(22,"Contrase\xF1a"),i(),c(23,"input",10),p(24,jt,1,1,"app-control-errors",6),i(),o(25,"mat-form-field")(26,"mat-label"),n(27," Rol "),i(),o(28,"mat-select",11)(29,"mat-option",12),n(30," Admin "),i(),o(31,"mat-option",13),n(32," User "),i()()()(),o(33,"div",14)(34,"button",15),n(35,"Cancelar"),i(),o(36,"button",16),b("click",function(){return a.onSave()}),n(37,"Guardar"),i()()()),t&2&&(m(),R(" ",(a.data==null?null:a.data.editUser)==null?"Crear":"Editar",` usuario
`),m(2),u("formGroup",a.userForm),m(6),u("ngIf",a.firstNameControl==null?null:a.firstNameControl.touched),m(5),u("ngIf",a.lastNameControl==null?null:a.lastNameControl.touched),m(5),u("ngIf",a.emailControl==null?null:a.emailControl.touched),m(5),u("ngIf",a.passwordControl==null?null:a.passwordControl.touched))},dependencies:[z,je,Re,$e,Oe,Le,ke,W,qe,He,ze,Je,De,Ye,Ze,tt,et,Y]})};var Dt=ne(me());var s=ye({source:"User",events:{"Load Users":Me(),"Load Users Success":f(),"Load Users Failure":f(),"Load User By Id":f(),"Load User By Id Success":f(),"Load User By Id Failure":f(),"Create User":f(),"Create User Success":f(),"Create User Failure":f(),"Update User":f(),"Update User Success":f(),"Update User Failure":f(),"Delete User":f(),"Delete User Success":f(),"Delete User Failure":f()}});var de="user",Lt={users:[],user:{}},kt=Te(Lt,U(s.loadUsers,e=>d({},e)),U(s.loadUsersSuccess,(e,r)=>C(d({},e),{users:r.data})),U(s.loadUsersFailure,(e,r)=>C(d({},e),{error:r})),U(s.loadUserById,e=>d({},e)),U(s.loadUserByIdSuccess,(e,{data:r})=>C(d({},e),{user:r})),U(s.loadUserByIdFailure,(e,r)=>C(d({},e),{error:r})),U(s.createUserSuccess,(e,{user:r})=>C(d({},e),{users:[...e.users,r]})),U(s.createUserFailure,(e,{error:r})=>C(d({},e),{error:r})),U(s.updateUser,e=>d({},e)),U(s.updateUserSuccess,(e,{user:r})=>C(d({},e),{users:e.users.map(t=>t.id===r.id?r:t)})),U(s.updateUserFailure,(e,{error:r})=>C(d({},e),{error:r})),U(s.deleteUser,(e,{id:r})=>C(d({},e),{users:e.users.filter(t=>t.id!==r)}))),ht=Ne({name:de,reducer:kt});var xt=Fe(de),Et=se(xt,e=>e.users),St=se(xt,e=>e.user);function qt(e,r){e&1&&c(0,"mat-spinner",4)}function zt(e,r){e&1&&(o(0,"th",16),n(1,"ID"),i())}function Kt(e,r){if(e&1&&(o(0,"td",17),n(1),i()),e&2){let t=r.$implicit;m(),h(t.id)}}function Jt(e,r){e&1&&(o(0,"th",16),n(1,"Name"),i())}function Qt(e,r){if(e&1&&(o(0,"td",17),n(1),y(2,"userFullName"),i()),e&2){let t=r.$implicit;m(),h(M(2,1,t))}}function Wt(e,r){e&1&&(o(0,"th",16),n(1,"Email"),i())}function Xt(e,r){if(e&1&&(o(0,"td",17),n(1),i()),e&2){let t=r.$implicit;m(),h(t.email)}}function Yt(e,r){e&1&&(o(0,"th",16),n(1,"Created Date"),i())}function Zt(e,r){if(e&1&&(o(0,"td",17),n(1),y(2,"date"),i()),e&2){let t=r.$implicit;m(),h(M(2,1,t.createdAt))}}function er(e,r){e&1&&(o(0,"th",16),n(1,"Role"),i())}function tr(e,r){if(e&1&&(o(0,"td",17),n(1),y(2,"titlecase"),i()),e&2){let t=r.$implicit;m(),h(M(2,1,t.role))}}function rr(e,r){e&1&&(o(0,"th",16),n(1,"Actions"),i())}function ir(e,r){if(e&1){let t=fe();o(0,"td",17)(1,"button",18),b("click",function(){let l=G(t).$implicit,v=g(2);return q(v.goToDetail(l.id))}),o(2,"mat-icon"),n(3,"visibility"),i()(),o(4,"button",18),b("click",function(){let l=G(t).$implicit,v=g(2);return q(v.openDialog(l))}),o(5,"mat-icon"),n(6,"edit"),i()(),o(7,"button",18),b("click",function(){let l=G(t).$implicit,v=g(2);return q(v.onDelete(l.id))}),o(8,"mat-icon"),n(9,"delete"),i()()()}}function or(e,r){e&1&&c(0,"tr",19)}function nr(e,r){e&1&&c(0,"tr",20)}function ar(e,r){if(e&1&&(o(0,"table",5),D(1,6),p(2,zt,2,0,"th",7)(3,Kt,2,1,"td",8),I(),D(4,9),p(5,Jt,2,0,"th",7)(6,Qt,3,3,"td",8),I(),D(7,10),p(8,Wt,2,0,"th",7)(9,Xt,2,1,"td",8),I(),D(10,11),p(11,Yt,2,0,"th",7)(12,Zt,3,3,"td",8),I(),D(13,12),p(14,er,2,0,"th",7)(15,tr,3,3,"td",8),I(),D(16,13),p(17,rr,2,0,"th",7)(18,ir,10,0,"td",8),I(),p(19,or,1,0,"tr",14)(20,nr,1,0,"tr",15),i()),e&2){let t=g();u("dataSource",t.users$),m(19),u("matHeaderRowDef",t.displayedColumns),m(),u("matRowDefColumns",t.displayedColumns)}}var ee=class e{constructor(r,t,a,l){this.matDialog=r;this.router=t;this.activatedRoute=a;this.store=l;this.users$=this.store.select(Et)}displayedColumns=["id","name","email","createdAt","role","actions"];users$;isLoading=!1;dataSource=[];ngOnInit(){this.store.dispatch(s.loadUsers())}goToDetail(r){this.router.navigate([r,"detail"],{relativeTo:this.activatedRoute})}openDialog(r){this.matDialog.open(Z,{data:{editUser:r}}).afterClosed().subscribe({next:t=>{t&&(r?this.store.dispatch(s.updateUser({id:r.id,update:t})):this.store.dispatch(s.createUser({user:t})))}})}onDelete(r){Dt.default.fire({title:"\xBFEst\xE1s seguro?",text:"No podr\xE1s revertir esta acci\xF3n",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&this.store.dispatch(s.deleteUser({id:r}))})}static \u0275fac=function(t){return new(t||e)(_(Xe),_(Se),_(J),_(Q))};static \u0275cmp=x({type:e,selectors:[["app-users"]],decls:10,vars:1,consts:[[1,"container","p-5"],[1,"p-2","rounded-4","bg-table"],[1,"demo-button-container","m-2"],["mat-flat-button","",3,"click"],[1,"mx-auto","m-5"],["mat-table","",1,"bg-table",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","email"],["matColumnDef","createdAt"],["matColumnDef","role"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",1,"m-1",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,a){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),b("click",function(){return a.openDialog()}),o(4,"mat-icon"),n(5,"add"),i(),n(6," Crear Usuario "),i()(),c(7,"mat-divider"),p(8,qt,1,0,"mat-spinner",4)(9,ar,21,3,"table",5),i()()),t&2&&(m(8),S(a.isLoading?8:9))},dependencies:[W,we,X,rt,ot,lt,nt,it,mt,at,st,pt,dt,ct,Be,K,he,Ct],styles:[".bg-table[_ngcontent-%COMP%]{background-color:#2e3b38}"]})};function sr(e,r){e&1&&(c(0,"mat-progress-bar",2),o(1,"p",3),n(2,"CARGANDO..."),i())}function lr(e,r){if(e&1&&(o(0,"div",4)(1,"h2",5),n(2),y(3,"titlecase"),i(),o(4,"div",6)(5,"div",7)(6,"div",8)(7,"mat-card",9)(8,"div",10),c(9,"img",11),i()()(),o(10,"mat-card",12)(11,"div")(12,"div",13)(13,"mat-icon",14),n(14,"fingerprint"),i(),o(15,"div",15)(16,"strong"),n(17,"ID:"),i(),o(18,"p"),n(19),i()()(),o(20,"div",13)(21,"mat-icon",14),n(22,"person"),i(),o(23,"div",15)(24,"strong"),n(25,"Nombre:"),i(),o(26,"p"),n(27),i()()(),o(28,"div",13)(29,"mat-icon",14),n(30,"email"),i(),o(31,"div",15)(32,"strong"),n(33,"Email:"),i(),o(34,"p"),n(35),i()()()()()()()()),e&2){let t=r.ngIf;m(2),R("Detalle de ",M(3,8,t.role),""),m(7),Ce("alt","`Avatar de ",t.firstName," ",t.lastName,"`"),m(10),h(t.id),m(8),_e("",t.firstName," ",t==null?null:t.lastName,""),m(8),h(t.email)}}var te=class e{constructor(r,t){this.activatedRoute=r;this.store=t;this.user$=this.store.select(St),this.userId$=this.activatedRoute.snapshot.params.id}userId$;user$;isLoading=!1;ngOnInit(){this.isLoading=!0,this.store.dispatch(s.loadUserById({id:this.userId$}))}static \u0275fac=function(t){return new(t||e)(_(J),_(Q))};static \u0275cmp=x({type:e,selectors:[["app-user-detail"]],decls:4,vars:4,consts:[["loading",""],["class","main-container",4,"ngIf","ngIfElse"],["mode","indeterminate"],[1,"text-center","my-5"],[1,"main-container"],[1,"text-center"],[1,"border","rounded","m-5"],[1,"align-items-center","d-flex","gap-4","p-3","text-center","justify-content-center"],[1,"col-4"],[1,"col-12","p-5","m-auto"],[1,"card-content","m-auto","text-center"],["src","https://picsum.photos/200","srcset","",3,"alt"],[1,"col-6","p-5","bg-table"],[1,"info-item"],["matListItemIcon",""],[1,"d-flex","gap-2"]],template:function(t,a){if(t&1&&(p(0,sr,3,0,"ng-template",null,0,ge)(2,lr,36,10,"div",1),y(3,"async")),t&2){let l=Ue(1);m(2),u("ngIf",M(3,2,a.user$))("ngIfElse",l)}},dependencies:[z,X,Ie,ut,Ve,ve,K],styles:[".main-container[_ngcontent-%COMP%]{padding-block:20vh}.dCards[_ngcontent-%COMP%]{height:20vh}.course-content[_ngcontent-%COMP%]{height:50vh}.info-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:10px}img[_ngcontent-%COMP%]{width:200px;height:200px;color:#fff}.bg-table[_ngcontent-%COMP%]{background-color:#2e3b38}"]})};var mr=[{path:"",component:ee},{path:":id/detail",component:te}],re=class e{static \u0275fac=function(t){return new(t||e)};static \u0275mod=H({type:e});static \u0275inj=V({imports:[ae.forChild(mr),ae]})};var L=ne(me());var ie=class e{constructor(r){this.httpClient=r}apiBaseURL=be.apiBaseURL;createUser(r){return this.httpClient.post(`${this.apiBaseURL}/users`,C(d({},r),{createdAt:new Date().toISOString(),token:j(15)}))}getUsers(){return this.httpClient.get(`${this.apiBaseURL}/users`)}getUserById(r){return this.httpClient.get(`${this.apiBaseURL}/users/${r}`)}updateUserById(r,t){return this.httpClient.patch(`${this.apiBaseURL}/users/${r}`,t).pipe($(()=>this.getUsers()))}removeUserById(r){return this.httpClient.delete(`${this.apiBaseURL}/users/${r}`).pipe($(()=>this.getUsers()))}static \u0275fac=function(t){return new(t||e)(O(Ee))};static \u0275prov=P({token:e,factory:e.\u0275fac,providedIn:"root"})};var oe=class e{constructor(r,t){this.actions$=r;this.usersService=t;this.loadUsers$=N(()=>this.actions$.pipe(A(s.loadUsers),$(a=>this.usersService.getUsers().pipe(E(l=>s.loadUsersSuccess({data:l})),B(l=>w(s.loadUsersFailure({error:l}))))))),this.loadUserById$=N(()=>this.actions$.pipe(A(s.loadUserById),k(({id:a})=>this.usersService.getUserById(a).pipe(E(l=>s.loadUserByIdSuccess({data:l})),B(l=>w(s.loadUserByIdFailure({error:l}))))))),this.loadUsersAfterUpdate$=N(()=>this.actions$.pipe(A(s.updateUserSuccess),E(()=>s.loadUsers()))),this.createUsers$=N(()=>this.actions$.pipe(A(s.createUser),k(({user:a})=>this.usersService.createUser(a).pipe(E(l=>s.createUserSuccess({user:l})),B(l=>(L.default.fire("Error","No se pudo crear el curso.","error"),w(s.createUserFailure({error:l})))))))),this.updateUsers$=N(()=>this.actions$.pipe(A(s.updateUser),ce(),k(({id:a,update:l})=>this.usersService.updateUserById(a,l).pipe(E(v=>{let bt=v[0];return s.updateUserSuccess({user:bt})}),B(v=>(L.default.fire("Error","No se pudo actualizar el curso.","error"),w(s.updateUserFailure({error:v})))))))),this.deleteUsers$=N(()=>this.actions$.pipe(A(s.deleteUser),ue(({id:a})=>this.usersService.removeUserById(a).pipe(E(l=>(L.default.fire("\xA1Eliminado!","El curso ha sido eliminado.","success"),s.deleteUserSuccess({data:l}))),B(l=>(L.default.fire("Error","Hubo un problema al eliminar el curso.","error"),w(s.deleteUserFailure({error:l}))))))))}loadUsers$;loadUserById$;loadUsersAfterUpdate$;deleteUsers$;updateUsers$;createUsers$;static \u0275fac=function(t){return new(t||e)(O(Ut),O(ie))};static \u0275prov=P({token:e,factory:e.\u0275fac})};var It=class e{static \u0275fac=function(t){return new(t||e)};static \u0275mod=H({type:e});static \u0275inj=V({imports:[xe,re,ft,_t.forFeature([oe]),Ae.forFeature(ht)]})};export{It as UsersModule};
