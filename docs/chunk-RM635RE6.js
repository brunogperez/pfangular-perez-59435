import{a,d as f}from"./chunk-52GIBL2D.js";import{a as h,o as c}from"./chunk-HNE7D7Y7.js";import{b as m,k as u}from"./chunk-4SWAUFVP.js";import{J as l,la as p,qa as i,s as n,x as r}from"./chunk-PWY5XFB5.js";var v=class s{constructor(t,e,o){this.router=t;this.httpClient=e;this.store=o;this.authUser$=this.store.select(f)}authUser$;apiURL=h.apiBaseURL;handleAuth(t){return t[0]?(this.store.dispatch(a.setAuthenticatedUser({user:t[0]})),localStorage.setItem("token",t[0].token),t[0]):null}login(t){return this.httpClient.get(`${this.apiURL}/users?email=${t.email}`).pipe(r(e=>{let o=e.find(U=>U.password===t.password);return this.handleAuth(o?[o]:[])}),r(e=>{if(e)return e;throw new Error("Los datos son inv\xE1lidos")}))}logout(){this.store.dispatch(a.unsetAuthenticatedUser()),localStorage.removeItem("token"),this.router.navigate(["auth","login"])}verifyToken(){let t=localStorage.getItem("token");return t?this.httpClient.get(`${this.apiURL}/users?token=${t}`).pipe(r(e=>!!this.handleAuth(e)),l(()=>n(!1))):n(!1)}isAdmin(){return this.authUser$.pipe(r(t=>!!t&&t.role==="admin"))}static \u0275fac=function(e){return new(e||s)(i(u),i(m),i(c))};static \u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"})};export{v as a};
